<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Géopolitique — Inflexion</title>
    <meta name="description" content="Analyses géopolitiques et leur impact sur les marchés : droits de douane, guerre des puces IA, tensions internationales et stratégies d'investissement.">
    <meta name="keywords" content="géopolitique, droits de douane, guerre commerciale, puces IA, Trump, Europe, Groenland, marchés financiers">
    <meta property="og:title" content="Géopolitique — Inflexion">
    <meta property="og:description" content="Analyses géopolitiques et leur impact sur les marchés : droits de douane, guerre des puces IA, tensions internationales.">
    <meta property="og:type" content="article">
    <meta property="og:site_name" content="Inflexion">
    <meta property="og:locale" content="fr_FR">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Géopolitique — Inflexion">
    <meta name="twitter:description" content="Analyses géopolitiques et leur impact sur les marchés financiers mondiaux.">
    <meta property="og:url" content="https://florycarm-a11y.github.io/Inflexion/geopolitics.html">
    <meta property="og:image" content="https://florycarm-a11y.github.io/Inflexion/og-image.png">
    <meta name="twitter:image" content="https://florycarm-a11y.github.io/Inflexion/og-image.png">
    <link rel="canonical" href="https://florycarm-a11y.github.io/Inflexion/geopolitics.html">
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="manifest" href="manifest.json">
    <script type="application/ld+json">
    [
        {
            "@context": "https://schema.org",
            "@type": "CollectionPage",
            "name": "Géopolitique — Inflexion",
            "description": "Analyses géopolitiques et leur impact sur les marchés financiers mondiaux.",
            "publisher": {"@type": "Organization", "name": "Inflexion"},
            "inLanguage": "fr"
        },
        {
            "@context": "https://schema.org",
            "@type": "BreadcrumbList",
            "itemListElement": [
                {"@type": "ListItem", "position": 1, "name": "Accueil", "item": "https://florycarm-a11y.github.io/Inflexion/"},
                {"@type": "ListItem", "position": 2, "name": "Géopolitique", "item": "https://florycarm-a11y.github.io/Inflexion/geopolitics.html"}
            ]
        }
    ]
    </script>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
    <a href="#main-content" class="skip-link">Aller au contenu principal</a>
    <header class="header" role="banner">
        <div class="container">
            <div class="header-top">
                <div class="header-left">
                    <button class="menu-trigger" aria-expanded="false" aria-controls="main-nav" aria-label="Ouvrir le menu de navigation">
                        <div class="hamburger" aria-hidden="true">
                            <span class="hamburger-bar"></span>
                            <span class="hamburger-bar"></span>
                            <span class="hamburger-bar"></span>
                        </div>
                    </button>
                    <a href="index.html" class="logo"><img src="logo-header.png" alt="Inflexion — Géopolitique &amp; Marchés" class="logo-img"></a>
                </div>
                <div class="header-controls">
                    <div class="market-status closed">
                        <span class="market-status-dot"></span>
                        <span class="market-status-text">Fermé</span>
                    </div>
                    <div class="header-search">
                        <form class="search-form" id="search-form">
                            <label for="search-input" class="sr-only">Rechercher sur Inflexion</label>
                            <input type="text" class="search-input" id="search-input" placeholder="Rechercher...">
                            <button type="submit" class="search-btn">Rechercher</button>
                        </form>
                    </div>
                    <a href="premium.html#contact" class="header-cta-btn">Réserver un diagnostic</a>
                </div>
            </div>
        </div>
    </header>
    <!-- Navigation Overlay -->
    <nav class="nav-overlay" id="main-nav" aria-label="Navigation principale">
        <div class="nav-overlay-content">
            <div class="nav-overlay-header">
                <span class="nav-overlay-title">Menu</span>
                <button class="nav-close" aria-label="Fermer le menu">&times;</button>
            </div>
            <div class="nav-links">
                <a href="index.html" class="nav-overlay-link">Accueil</a>
                <span class="nav-overlay-group-label">Veille</span>
                <a href="geopolitics.html" class="nav-overlay-link nav-indent" aria-current="page">Géopolitique</a>
                <a href="markets.html" class="nav-overlay-link nav-indent">Marchés</a>
                <a href="crypto.html" class="nav-overlay-link nav-indent">Crypto</a>
                <a href="commodities.html" class="nav-overlay-link nav-indent">Matières premières</a>
                <a href="etf.html" class="nav-overlay-link nav-indent">ETF</a>
                <a href="analysis.html" class="nav-overlay-link nav-indent">Analyses</a>
                <span class="nav-overlay-group-label">Conseil</span>
                <a href="premium.html" class="nav-overlay-link">Nos Services</a>
                <a href="analysis.html#cas-usage" class="nav-overlay-link">Cas d'usage</a>
                <a href="expertise.html" class="nav-overlay-link">Notre Expertise</a>
                <a href="premium.html#contact" class="nav-overlay-link nav-cta">Réserver un diagnostic</a>
            </div>
        </div>
    </nav>

    <main class="main-content" id="main-content">
        <div class="container">
            <div class="page-header" data-category="geopolitics">
                <h1 class="page-title">Géopolitique & Pays</h1>
                <p class="page-subtitle">Événements internationaux, données macro par pays et leur impact sur les marchés</p>
            </div>

            <div id="category-trend"></div>

            <!-- Onglets internes Actualités / Macro par Pays -->
            <div class="page-tabs" id="geo-tabs" role="tablist" aria-label="Sous-rubriques Géopolitique">
                <button class="page-tab active" role="tab" aria-selected="true" aria-controls="tab-geo-news" data-tab="geo-news">Actualités</button>
                <button class="page-tab" role="tab" aria-selected="false" aria-controls="tab-geo-pays" data-tab="geo-pays">Macro par Pays</button>
            </div>

            <!-- ═══ Tab: Actualités géopolitiques ═══ -->
            <div class="tab-panel active" id="tab-geo-news" role="tabpanel">
                <!-- Analyse a la une -->
                <section class="rubrique-featured-analysis">
                    <h2 class="section-title">Analyse à la une</h2>
                    <a href="analyse-droits-douane-trump-groenland.html" class="featured-analysis-card">
                        <div class="featured-analysis-banner" style="background: linear-gradient(135deg, #064E3B 0%, #059669 100%);">
                            <span class="featured-analysis-label">Analyse de la semaine</span>
                        </div>
                        <div class="featured-analysis-body">
                            <h3>Droits de douane Trump sur le Groenland : quand la géopolitique efface 1 200 milliards de Wall Street en une séance</h3>
                            <p>Le président américain a relancé la guerre commerciale contre l'UE en conditionnant la levée de droits de douane au soutien européen sur le Groenland. S&amp;P 500 -2,1 %, VIX au-dessus de 20.</p>
                            <span class="featured-analysis-meta">4 février 2026 — 10 min de lecture</span>
                        </div>
                    </a>
                </section>

                <div class="section-filters" id="filters">
                    <button class="filter-btn active" data-filter="all">Tous</button>
                    <button class="filter-btn" data-filter="conflicts">Conflits</button>
                    <button class="filter-btn" data-filter="trade">Commerce</button>
                    <button class="filter-btn" data-filter="politics">Politique</button>
                </div>

                <div class="two-col">
                    <div class="col-main">
                        <div class="news-grid" id="page-news" aria-live="polite">
                            <div class="loading" role="status"><div class="loading-spinner"></div><span class="sr-only">Chargement des articles...</span></div>
                        </div>
                    </div>
                    <aside class="col-side">
                        <div class="sidebar-block sidebar-card">
                            <h3 class="sidebar-title"><svg class="sidebar-icon" viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg> Marchés</h3>
                            <div class="market-table" id="market-table" aria-live="polite" role="region" aria-label="Cours des marchés en temps réel"></div>
                            <a href="markets.html" class="sidebar-more">Voir tous les marchés</a>
                        </div>

                        <!-- Indicateurs Macro (FRED) -->
                        <div class="sidebar-block sidebar-card" id="macro-section">
                            <h3 class="sidebar-title"><svg class="sidebar-icon" viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 21h18M3 10h18M3 7l9-4 9 4M4 10v11M20 10v11M8 14v3M12 14v3M16 14v3"/></svg> Indicateurs Macro</h3>
                            <div class="macro-indicators" id="macro-indicators">
                                <p class="macro-placeholder">Chargement...</p>
                            </div>
                            <span class="sidebar-source">Source : Réserve fédérale (FRED)</span>
                        </div>

                        <!-- Analyse Macro IA -->
                        <div class="sidebar-block sidebar-card" id="macro-analysis-section">
                            <h3 class="sidebar-title"><svg class="sidebar-icon" viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 20V10M12 20V4M6 20v-6"/></svg> Analyse Macro</h3>
                            <div id="macro-analysis-widget" class="macro-analysis-widget">
                                <p class="macro-analysis-placeholder">Chargement...</p>
                            </div>
                            <span class="sidebar-source">Source : Claude IA + FRED</span>
                        </div>

                        <!-- Macro Internationale (Banque mondiale) -->
                        <div class="sidebar-block sidebar-card" id="world-bank-section">
                            <h3 class="sidebar-title"><svg class="sidebar-icon" viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 20V10M12 20V4M6 20v-6"/></svg> Macro Internationale</h3>
                            <div id="world-bank-widget" class="world-bank-widget">
                                <p class="wb-placeholder">Chargement...</p>
                            </div>
                            <span class="sidebar-source">Source : Banque mondiale</span>
                        </div>
                    </aside>
                </div>
            </div>

            <!-- ═══ Tab: Macro par Pays ═══ -->
            <div class="tab-panel" id="tab-geo-pays" role="tabpanel" hidden>
                <section class="country-selector" id="country-selector">
                    <div class="country-grid" role="list" aria-label="Sélection de pays">
                        <div class="loading" role="status"><div class="loading-spinner"></div><span class="sr-only">Chargement des pays...</span></div>
                    </div>
                </section>

                <section class="country-detail" id="country-detail" aria-live="polite" hidden>
                    <button class="country-back-btn" id="country-back" aria-label="Retour à la liste des pays">
                        <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>
                        Tous les pays
                    </button>
                    <div class="country-detail-header" id="country-detail-header"></div>
                    <div class="country-indicators-grid" id="country-indicators"></div>
                    <div class="country-sources">
                        <span class="sidebar-source">Sources : World Bank, FRED, ECB, IMF</span>
                    </div>
                </section>
            </div>
        </div>
    </main>

    <footer class="footer" role="contentinfo">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section footer-about">
                    <strong>Inflexion</strong>
                    <p>Plateforme d'intelligence financière combinant analyses géopolitiques, données de marché en temps réel et synthèses IA quotidiennes.</p>
                    <p class="footer-brand-tagline">Comprendre avant d'agir. Agir avant de subir.</p>
                    <div class="footer-social">
                        <a href="https://twitter.com" target="_blank" rel="noopener noreferrer" aria-label="Twitter" title="Twitter"><svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M23 3a10.9 10.9 0 01-3.14 1.53 4.48 4.48 0 00-7.86 3v1A10.66 10.66 0 013 4s-4 9 5 13a11.64 11.64 0 01-7 2s9 5 20 5a9.5 9.5 0 00-9-5.5c4.75 2.25 9 0 11-4s1-6.08 1-6.08a4.5 4.5 0 00 .78-2.221z"/></svg></a>
                        <a href="https://linkedin.com" target="_blank" rel="noopener noreferrer" aria-label="LinkedIn" title="LinkedIn"><svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6zM2 9h4v12H2z"/><circle cx="4" cy="4" r="2"/></svg></a>
                        <a href="https://github.com/florycarm-a11y/Inflexion" target="_blank" rel="noopener noreferrer" aria-label="GitHub" title="GitHub"><svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.6.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v 3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg></a>
                    </div>
                    <div class="footer-sources">
                        <span class="footer-source-tag">F.L</span>
                        <span class="footer-source-tag">15 APIs</span>
                        <span class="footer-source-tag">158 sources</span>
                        <span class="footer-source-tag">CFR</span>
                        <span class="footer-source-tag">IFRI</span>
                        <span class="footer-source-tag">SIPRI</span>
                        <span class="footer-source-tag">Chatham House</span>
                        <span class="footer-source-tag">FMI</span>
                        <span class="footer-source-tag">BCE</span>
                        <span class="footer-source-tag">FRED</span>
                        <span class="footer-source-tag">BIS</span>
                        <span class="footer-source-tag">IEA</span>
                        <span class="footer-source-tag">Banque mondiale</span>
                        <span class="footer-source-tag">OPEC</span>
                    </div>
                </div>
                <div class="footer-section">
                    <strong>Veille</strong>
                    <ul class="footer-links">
                        <li><a href="geopolitics.html">Géopolitique</a></li>
                        <li><a href="markets.html">Marchés</a></li>
                        <li><a href="crypto.html">Crypto</a></li>
                        <li><a href="commodities.html">Matières premières</a></li>
                        <li><a href="analysis.html">Analyses</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <strong>Conseil</strong>
                    <ul class="footer-links">
                        <li><a href="premium.html"><strong>Nos Services</strong></a></li>
                        <li><a href="analysis.html#cas-usage">Cas d'usage</a></li>
                        <li><a href="expertise.html">Notre Expertise</a></li>
                        <li><a href="premium.html#contact">Contact</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <strong>Légal</strong>
                    <ul class="footer-links">
                        <li><a href="mentions-legales.html">Mentions légales</a></li>
                        <li><a href="confidentialite.html">Confidentialité</a></li>
                        <li><a href="cgu.html">CGU</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-disclaimer">
                Les informations présentées sont fournies à titre informatif uniquement et ne constituent en aucun cas des conseils en investissement. Les performances passées ne préjugent pas des performances futures.
            </div>
            <div class="footer-bottom">
                &copy; 2026 Inflexion. Données issues de sources publiques vérifiées. Propulsé par Claude (Anthropic).
            </div>
        </div>
    </footer>

    <!-- Back to Top -->
    <button class="back-to-top" aria-label="Retour en haut">
        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="18 15 12 9 6 15"></polyline></svg>
    </button>

    <script src="app.js"></script>
    <script src="data-loader.js"></script>
    <script>if (typeof initCategoryPage === 'function') initCategoryPage('geopolitics');</script>
    <script>
    // Tab switching + Country macro integration
    (function() {
        'use strict';

        // ── Tab switching ──
        var tabs = document.querySelectorAll('#geo-tabs .page-tab');
        var panels = document.querySelectorAll('.tab-panel');
        var countryInitialized = false;

        tabs.forEach(function(tab) {
            tab.addEventListener('click', function() {
                var target = tab.dataset.tab;
                tabs.forEach(function(t) { t.classList.remove('active'); t.setAttribute('aria-selected', 'false'); });
                tab.classList.add('active');
                tab.setAttribute('aria-selected', 'true');
                panels.forEach(function(p) { p.hidden = true; p.classList.remove('active'); });
                var panel = document.getElementById(target);
                if (panel) { panel.hidden = false; panel.classList.add('active'); }
                if (target === 'tab-geo-pays' && !countryInitialized) {
                    countryInitialized = true;
                    initCountryData();
                }
            });
        });

        // Handle URL param
        var params = new URLSearchParams(window.location.search);
        if (params.get('country') || params.get('tab') === 'pays') {
            var paysTab = document.querySelector('[data-tab="tab-geo-pays"]');
            if (paysTab) paysTab.click();
        }

        // ── Country macro data ──
        var COUNTRIES = {
            USA: { flag: '\u{1F1FA}\u{1F1F8}', name: '\u00C9tats-Unis', currency: 'USD', region: 'Am\u00E9rique du Nord' },
            CHN: { flag: '\u{1F1E8}\u{1F1F3}', name: 'Chine', currency: 'CNY', region: 'Asie' },
            JPN: { flag: '\u{1F1EF}\u{1F1F5}', name: 'Japon', currency: 'JPY', region: 'Asie' },
            DEU: { flag: '\u{1F1E9}\u{1F1EA}', name: 'Allemagne', currency: 'EUR', region: 'Europe' },
            GBR: { flag: '\u{1F1EC}\u{1F1E7}', name: 'Royaume-Uni', currency: 'GBP', region: 'Europe' },
            FRA: { flag: '\u{1F1EB}\u{1F1F7}', name: 'France', currency: 'EUR', region: 'Europe' },
            IND: { flag: '\u{1F1EE}\u{1F1F3}', name: 'Inde', currency: 'INR', region: 'Asie' },
            BRA: { flag: '\u{1F1E7}\u{1F1F7}', name: 'Br\u00E9sil', currency: 'BRL', region: 'Am\u00E9rique du Sud' },
            CAN: { flag: '\u{1F1E8}\u{1F1E6}', name: 'Canada', currency: 'CAD', region: 'Am\u00E9rique du Nord' },
            KOR: { flag: '\u{1F1F0}\u{1F1F7}', name: 'Cor\u00E9e du Sud', currency: 'KRW', region: 'Asie' }
        };

        var INDICATOR_LABELS = {
            'NY.GDP.MKTP.CD': { label: 'PIB nominal', unit: 'USD', format: 'usd' },
            'FP.CPI.TOTL.ZG': { label: 'Inflation (CPI)', unit: '% annuel', format: 'pct' },
            'SL.UEM.TOTL.ZS': { label: 'Ch\u00F4mage', unit: '% pop. active', format: 'pct' },
            'GC.DOD.TOTL.GD.ZS': { label: 'Dette / PIB', unit: '%', format: 'pct' }
        };

        var selectedCountry = null;

        function initCountryData() {
            var wb = typeof DataLoader !== 'undefined' ? DataLoader.getWorldBank() : null;
            if (wb) renderCountryGrid(wb);
            else {
                var grid = document.querySelector('.country-grid');
                if (grid) grid.innerHTML = '<p class="loading-fallback-text">Donn\u00E9es macro indisponibles.</p>';
            }
        }

        function renderCountryGrid(wb) {
            var grid = document.querySelector('.country-grid');
            if (!grid) return;
            grid.innerHTML = Object.keys(COUNTRIES).map(function(code) {
                var meta = COUNTRIES[code];
                var gdpStr = '';
                if (wb && wb.indicators) {
                    var gdpInd = wb.indicators.find(function(i) { return i.id === 'NY.GDP.MKTP.CD'; });
                    if (gdpInd && gdpInd.data) {
                        var match = gdpInd.data.find(function(d) { return d.country_code === code; });
                        if (match) gdpStr = formatLargeUSD(match.value);
                    }
                }
                return '<button class="country-card" role="listitem" data-code="' + code + '" aria-label="' + meta.name + '">' +
                    '<span class="country-card-flag">' + meta.flag + '</span>' +
                    '<span class="country-card-name">' + meta.name + '</span>' +
                    '<span class="country-card-region">' + meta.region + '</span>' +
                    (gdpStr ? '<span class="country-card-gdp">PIB ' + gdpStr + '</span>' : '') +
                '</button>';
            }).join('');

            grid.addEventListener('click', function(e) {
                var card = e.target.closest('.country-card');
                if (card) selectCountry(card.dataset.code);
            });

            var backBtn = document.getElementById('country-back');
            if (backBtn) backBtn.addEventListener('click', function() { deselectCountry(); });
        }

        function selectCountry(code) {
            selectedCountry = code;
            var meta = COUNTRIES[code];
            if (!meta) return;
            var selector = document.getElementById('country-selector');
            var detail = document.getElementById('country-detail');
            var header = document.getElementById('country-detail-header');
            var indicators = document.getElementById('country-indicators');
            if (selector) selector.hidden = true;
            if (detail) detail.hidden = false;
            if (header) {
                header.innerHTML = '<div class="country-detail-title"><span class="country-detail-flag">' + meta.flag + '</span><div><h2>' + meta.name + '</h2><span class="country-detail-meta">' + meta.region + ' &middot; ' + meta.currency + '</span></div></div>';
            }
            if (indicators) renderCountryIndicators(code, indicators);
        }

        function deselectCountry() {
            selectedCountry = null;
            var selector = document.getElementById('country-selector');
            var detail = document.getElementById('country-detail');
            if (selector) selector.hidden = false;
            if (detail) detail.hidden = true;
        }

        function renderCountryIndicators(code, container) {
            var wb = DataLoader.getWorldBank();
            if (!wb || !wb.indicators) { container.innerHTML = '<p class="loading-fallback-text">Donn\u00E9es indisponibles.</p>'; return; }
            var cards = [];
            wb.indicators.forEach(function(ind) {
                var meta = INDICATOR_LABELS[ind.id];
                if (!meta || !ind.data) return;
                var match = ind.data.find(function(d) { return d.country_code === code; });
                if (!match) return;
                var displayVal = meta.format === 'usd' ? formatLargeUSD(match.value) : match.value.toFixed(1) + '%';
                var severity = '';
                if (ind.id === 'FP.CPI.TOTL.ZG') severity = match.value > 5 ? 'high' : match.value > 3 ? 'medium' : 'low';
                else if (ind.id === 'SL.UEM.TOTL.ZS') severity = match.value > 8 ? 'high' : match.value > 5 ? 'medium' : 'low';
                else if (ind.id === 'GC.DOD.TOTL.GD.ZS') severity = match.value > 100 ? 'high' : match.value > 60 ? 'medium' : 'low';
                var rank = 1;
                var sorted = ind.data.slice().sort(function(a, b) { return ind.id === 'NY.GDP.MKTP.CD' ? b.value - a.value : a.value - b.value; });
                for (var i = 0; i < sorted.length; i++) { if (sorted[i].country_code === code) { rank = i + 1; break; } }
                cards.push(
                    '<div class="country-ind-card' + (severity ? ' severity-' + severity : '') + '">' +
                    '<div class="country-ind-content"><span class="country-ind-label">' + meta.label + '</span>' +
                    '<span class="country-ind-value">' + displayVal + '</span>' +
                    '<span class="country-ind-unit">' + meta.unit + ' (' + (match.year || '2024') + ')</span></div>' +
                    '<div class="country-ind-rank"><span class="country-ind-rank-num">#' + rank + '</span><span class="country-ind-rank-total">/ ' + ind.data.length + '</span></div></div>'
                );
            });
            // Comparison table
            var tableHTML = '<div class="country-comparison"><h3 class="country-comparison-title">Comparaison internationale</h3><div class="country-comparison-table-wrapper"><table class="country-comparison-table"><thead><tr><th>Pays</th>';
            wb.indicators.forEach(function(ind) { var m = INDICATOR_LABELS[ind.id]; if (m) tableHTML += '<th>' + m.label + '</th>'; });
            tableHTML += '</tr></thead><tbody>';
            Object.keys(COUNTRIES).forEach(function(cc) {
                var m = COUNTRIES[cc];
                tableHTML += '<tr class="' + (cc === code ? 'country-row-selected' : '') + '"><td class="country-comp-name">' + m.flag + ' ' + m.name + '</td>';
                wb.indicators.forEach(function(ind) {
                    var im = INDICATOR_LABELS[ind.id]; if (!im) return;
                    var match = ind.data ? ind.data.find(function(d) { return d.country_code === cc; }) : null;
                    tableHTML += '<td class="country-comp-val">' + (match ? (im.format === 'usd' ? formatLargeUSD(match.value) : match.value.toFixed(1) + '%') : '\u2014') + '</td>';
                });
                tableHTML += '</tr>';
            });
            tableHTML += '</tbody></table></div></div>';
            container.innerHTML = '<div class="country-ind-cards">' + cards.join('') + '</div>' + tableHTML;
        }

        function formatLargeUSD(v) {
            if (v >= 1e12) return (v / 1e12).toFixed(1) + ' T$';
            if (v >= 1e9) return (v / 1e9).toFixed(0) + ' Mrd$';
            if (v >= 1e6) return (v / 1e6).toFixed(0) + ' M$';
            return v.toLocaleString('fr-FR') + ' $';
        }

        window.addEventListener('popstate', function() {
            var p = new URLSearchParams(window.location.search);
            var c = p.get('country');
            if (c && COUNTRIES[c]) selectCountry(c);
            else deselectCountry();
        });
    })();
    </script>
</body>
</html>
